<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Analytics SDK æ¼”ç¤º</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        
        .container {
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 30px;
        }
        
        .section {
            margin-bottom: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 5px;
        }
        
        .section h3 {
            margin-top: 0;
            color: #495057;
        }
        
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
            font-size: 14px;
        }
        
        button:hover {
            background: #0056b3;
        }
        
        input, textarea {
            width: 100%;
            padding: 8px;
            margin: 5px 0;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
        }
        
        .status {
            background: #e9ecef;
            padding: 15px;
            border-radius: 4px;
            margin-top: 20px;
            font-family: monospace;
            font-size: 12px;
            white-space: pre-wrap;
        }
        
        .api-list {
            background: #fff3cd;
            padding: 15px;
            border-radius: 4px;
            margin-top: 10px;
        }
        
        .api-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 5px 0;
            border-bottom: 1px solid #eee;
        }
        
        .api-item:last-child {
            border-bottom: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ“Š Analytics SDK æ¼”ç¤º</h1>
        
        <!-- ç”¨æˆ·ä¿¡æ¯è®¾ç½® -->
        <div class="section">
            <h3>ğŸ‘¤ ç”¨æˆ·ä¿¡æ¯è®¾ç½®</h3>
            <input type="text" id="userId" placeholder="è¾“å…¥ç”¨æˆ·ID" value="demo-user-123">
            <input type="text" id="userPlan" placeholder="ç”¨æˆ·è®¡åˆ’" value="premium">
            <button onclick="updateUserInfo()">æ›´æ–°ç”¨æˆ·ä¿¡æ¯</button>
        </div>
        
        <!-- é¡µé¢è¿½è¸ª -->
        <div class="section">
            <h3>ğŸ“„ é¡µé¢è¿½è¸ª</h3>
            <button onclick="trackCustomPage()">è¿½è¸ªè‡ªå®šä¹‰é¡µé¢</button>
            <button onclick="simulatePageChange()">æ¨¡æ‹Ÿé¡µé¢è·³è½¬</button>
        </div>
        
        <!-- ç”¨æˆ·æ“ä½œè¿½è¸ª -->
        <div class="section">
            <h3>ğŸ–±ï¸ ç”¨æˆ·æ“ä½œè¿½è¸ª</h3>
            <button onclick="trackSearch()">æœç´¢æ“ä½œ</button>
            <button onclick="trackPurchase()">è´­ä¹°æ“ä½œ</button>
            <button onclick="trackShare()">åˆ†äº«æ“ä½œ</button>
            <button onclick="throwError()">è§¦å‘é”™è¯¯</button>
        </div>
        
        <!-- è¡¨å•äº¤äº’ -->
        <div class="section">
            <h3>ğŸ“ è¡¨å•äº¤äº’</h3>
            <input type="text" placeholder="æœç´¢å…³é”®è¯..." id="searchInput">
            <textarea placeholder="ç”¨æˆ·åé¦ˆ..." id="feedbackText" rows="3"></textarea>
            <button onclick="submitForm()">æäº¤è¡¨å•</button>
        </div>
        
        <!-- API è°ƒç”¨æ¨¡æ‹Ÿ -->
        <div class="section">
            <h3>ğŸŒ API è°ƒç”¨æ¨¡æ‹Ÿ</h3>
            <button onclick="callGetAPI()">GET è¯·æ±‚</button>
            <button onclick="callPostAPI()">POST è¯·æ±‚</button>
            <button onclick="callFailAPI()">å¤±è´¥è¯·æ±‚</button>
            
            <div class="api-list">
                <h4>API è°ƒç”¨è®°å½•ï¼š</h4>
                <div id="apiCalls"></div>
            </div>
        </div>
        
        <!-- æ•°æ®æ§åˆ¶ -->
        <div class="section">
            <h3>âš™ï¸ æ•°æ®æ§åˆ¶</h3>
            <button onclick="flushData()">ç«‹å³å‘é€æ•°æ®</button>
            <button onclick="clearStorage()">æ¸…ç©ºæœ¬åœ°å­˜å‚¨</button>
            <button onclick="showStatus()">æ˜¾ç¤ºçŠ¶æ€</button>
        </div>
        
        <!-- çŠ¶æ€æ˜¾ç¤º -->
        <div class="status" id="status">
ç­‰å¾…æ“ä½œ...

ğŸ’¡ æç¤ºï¼šæ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…·æŸ¥çœ‹è¯¦ç»†çš„åŸ‹ç‚¹æ•°æ®
        </div>
    </div>

    <!-- å¼•å…¥ SDK -->
    <script src="./dist/index.js"></script>
    
    <script>
        // åˆå§‹åŒ– Analytics SDK
        const analytics = new Analytics({
            appId: 'demo-app',
            apiEndpoint: 'https://httpbin.org/post', // ä½¿ç”¨ httpbin ä½œä¸ºæµ‹è¯•æ¥å£
            debug: true,
            enablePV: true,
            enableUserTracking: true,
            enableClickTracking: true,
            enableApiTracking: true,
            enableErrorTracking: true,
            batchSize: 3,
            flushInterval: 10000,
            customUserInfo: {
                demo: true,
                environment: 'development'
            }
        });

        let apiCallCount = 0;

        // æ›´æ–°çŠ¶æ€æ˜¾ç¤º
        function updateStatus(message) {
            const status = document.getElementById('status');
            const timestamp = new Date().toLocaleTimeString();
            status.textContent = `[${timestamp}] ${message}\n\n${status.textContent}`;
        }

        // æ›´æ–°ç”¨æˆ·ä¿¡æ¯
        function updateUserInfo() {
            const userId = document.getElementById('userId').value;
            const userPlan = document.getElementById('userPlan').value;
            
            analytics.setUserId(userId);
            analytics.setUserInfo({
                customProperties: {
                    plan: userPlan,
                    demo: true,
                    lastUpdate: new Date().toISOString()
                }
            });
            
            updateStatus(`ç”¨æˆ·ä¿¡æ¯å·²æ›´æ–°: ID=${userId}, Plan=${userPlan}`);
        }

        // è¿½è¸ªè‡ªå®šä¹‰é¡µé¢
        function trackCustomPage() {
            analytics.trackPageView('/demo/custom-page', 'è‡ªå®šä¹‰æ¼”ç¤ºé¡µé¢');
            updateStatus('å·²è¿½è¸ªè‡ªå®šä¹‰é¡µé¢è®¿é—®');
        }

        // æ¨¡æ‹Ÿé¡µé¢è·³è½¬
        function simulatePageChange() {
            const pages = [
                { url: '/home', title: 'é¦–é¡µ' },
                { url: '/products', title: 'äº§å“é¡µ' },
                { url: '/about', title: 'å…³äºæˆ‘ä»¬' },
                { url: '/contact', title: 'è”ç³»æˆ‘ä»¬' }
            ];
            
            const randomPage = pages[Math.floor(Math.random() * pages.length)];
            analytics.trackPageView(randomPage.url, randomPage.title);
            updateStatus(`æ¨¡æ‹Ÿè®¿é—®é¡µé¢: ${randomPage.title} (${randomPage.url})`);
        }

        // è¿½è¸ªæœç´¢æ“ä½œ
        function trackSearch() {
            const keywords = ['analytics', 'tracking', 'åŸ‹ç‚¹', 'dashboard', 'data'];
            const keyword = keywords[Math.floor(Math.random() * keywords.length)];
            
            analytics.trackAction('search', {
                keyword: keyword,
                source: 'demo',
                resultsCount: Math.floor(Math.random() * 100)
            });
            
            updateStatus(`å·²è¿½è¸ªæœç´¢æ“ä½œ: "${keyword}"`);
        }

        // è¿½è¸ªè´­ä¹°æ“ä½œ
        function trackPurchase() {
            analytics.trackAction('purchase', {
                productId: 'demo-product-' + Math.floor(Math.random() * 1000),
                amount: (Math.random() * 1000).toFixed(2),
                currency: 'CNY',
                paymentMethod: 'credit_card'
            });
            
            updateStatus('å·²è¿½è¸ªè´­ä¹°æ“ä½œ');
        }

        // è¿½è¸ªåˆ†äº«æ“ä½œ
        function trackShare() {
            const platforms = ['wechat', 'weibo', 'qq', 'twitter', 'facebook'];
            const platform = platforms[Math.floor(Math.random() * platforms.length)];
            
            analytics.trackAction('share', {
                platform: platform,
                content: 'Analytics SDK Demo',
                url: window.location.href
            });
            
            updateStatus(`å·²è¿½è¸ªåˆ†äº«æ“ä½œ: ${platform}`);
        }

        // è§¦å‘é”™è¯¯
        function throwError() {
            try {
                // æ•…æ„è§¦å‘é”™è¯¯
                throw new Error('è¿™æ˜¯ä¸€ä¸ªæ¼”ç¤ºé”™è¯¯: ' + Date.now());
            } catch (error) {
                analytics.trackError(error, 'custom');
                updateStatus('å·²è§¦å‘å¹¶è¿½è¸ªé”™è¯¯');
            }
        }

        // æäº¤è¡¨å•
        function submitForm() {
            const searchKeyword = document.getElementById('searchInput').value;
            const feedback = document.getElementById('feedbackText').value;
            
            analytics.trackAction('form_submit', {
                formType: 'demo_form',
                searchKeyword: searchKeyword,
                feedbackLength: feedback.length,
                hasSearch: !!searchKeyword,
                hasFeedback: !!feedback
            });
            
            updateStatus(`å·²è¿½è¸ªè¡¨å•æäº¤: æœç´¢="${searchKeyword}", åé¦ˆé•¿åº¦=${feedback.length}`);
        }

        // æ¨¡æ‹Ÿ GET API è°ƒç”¨
        async function callGetAPI() {
            try {
                const response = await fetch('https://jsonplaceholder.typicode.com/posts/1');
                const data = await response.json();
                
                addAPICall('GET', '/posts/1', response.status, 'success');
                updateStatus('GET API è°ƒç”¨æˆåŠŸ');
            } catch (error) {
                addAPICall('GET', '/posts/1', 0, 'error');
                updateStatus('GET API è°ƒç”¨å¤±è´¥');
            }
        }

        // æ¨¡æ‹Ÿ POST API è°ƒç”¨
        async function callPostAPI() {
            try {
                const response = await fetch('https://jsonplaceholder.typicode.com/posts', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        title: 'Demo Post',
                        body: 'This is a demo post from Analytics SDK',
                        userId: 1
                    })
                });
                
                const data = await response.json();
                addAPICall('POST', '/posts', response.status, 'success');
                updateStatus('POST API è°ƒç”¨æˆåŠŸ');
            } catch (error) {
                addAPICall('POST', '/posts', 0, 'error');
                updateStatus('POST API è°ƒç”¨å¤±è´¥');
            }
        }

        // æ¨¡æ‹Ÿå¤±è´¥çš„ API è°ƒç”¨
        async function callFailAPI() {
            try {
                const response = await fetch('https://nonexistent-api.example.com/fail');
                addAPICall('GET', '/fail', response.status, 'success');
            } catch (error) {
                addAPICall('GET', '/fail', 0, 'error');
                updateStatus('API è°ƒç”¨å¤±è´¥ï¼ˆé¢„æœŸï¼‰');
            }
        }

        // æ·»åŠ  API è°ƒç”¨è®°å½•åˆ°é¡µé¢
        function addAPICall(method, url, status, result) {
            apiCallCount++;
            const apiCalls = document.getElementById('apiCalls');
            const callDiv = document.createElement('div');
            callDiv.className = 'api-item';
            callDiv.innerHTML = `
                <span>${apiCallCount}. ${method} ${url}</span>
                <span style="color: ${result === 'success' ? 'green' : 'red'}">
                    ${status} ${result}
                </span>
            `;
            apiCalls.insertBefore(callDiv, apiCalls.firstChild);
        }

        // ç«‹å³å‘é€æ•°æ®
        async function flushData() {
            await analytics.flush();
            updateStatus('å·²ç«‹å³å‘é€æ‰€æœ‰ç¼“å­˜æ•°æ®');
        }

        // æ¸…ç©ºæœ¬åœ°å­˜å‚¨
        function clearStorage() {
            localStorage.removeItem('analytics_user_id');
            localStorage.removeItem('analytics_session_id');
            localStorage.removeItem('analytics_session_time');
            updateStatus('å·²æ¸…ç©ºæœ¬åœ°å­˜å‚¨ï¼Œåˆ·æ–°é¡µé¢åå°†ç”Ÿæˆæ–°çš„ç”¨æˆ·å’Œä¼šè¯ID');
        }

        // æ˜¾ç¤ºå½“å‰çŠ¶æ€
        function showStatus() {
            const userId = localStorage.getItem('analytics_user_id');
            const sessionId = localStorage.getItem('analytics_session_id');
            const sessionTime = localStorage.getItem('analytics_session_time');
            
            const statusInfo = {
                userId: userId,
                sessionId: sessionId,
                sessionStartTime: sessionTime ? new Date(parseInt(sessionTime)).toLocaleString() : 'N/A',
                pageTitle: document.title,
                pageUrl: window.location.href,
                userAgent: navigator.userAgent.substring(0, 50) + '...'
            };
            
            updateStatus('å½“å‰çŠ¶æ€:\n' + JSON.stringify(statusInfo, null, 2));
        }

        // é¡µé¢åŠ è½½å®Œæˆåçš„åˆå§‹åŒ–
        window.addEventListener('load', () => {
            updateStatus('Analytics SDK æ¼”ç¤ºé¡µé¢å·²åŠ è½½');
            updateStatus('è‡ªåŠ¨è¿½è¸ªåŠŸèƒ½å·²å¯ç”¨ï¼šé¡µé¢è®¿é—®ã€ç‚¹å‡»äº‹ä»¶ã€APIè°ƒç”¨ã€é”™è¯¯ç›‘æ§');
        });

        // ç›‘å¬é¡µé¢å¸è½½ï¼Œå‘é€æœ€ç»ˆæ•°æ®
        window.addEventListener('beforeunload', () => {
            analytics.flush();
        });
    </script>
</body>
</html>
